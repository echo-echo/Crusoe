<template name = "profile">

  {{> writeMessage}}

  {{#if currentUser}}
    {{>profileView}}
    <a id="signout" class = "btn" href="/">Sign Out</a>
  {{else}}
    {{>signin}}
  {{/if}}

  {{>confirmDelete}}
  {{>promptDelete}}
  {{>error}}

</template>

<template name = "profileView">
  <div class="row">
      <div class="col s12">
        <ul class="tabs">
            <li class="tab col s6"><a href="#myMessages" class="active"><h5 class = "profile-header">My Messages</h5></a></li>
            <li class="tab col s6"><a href="#taggedMessages"><h5 class = "profile-header">Tagged Messages</h5></a></li>
        </ul>
      </div>

      <div id="myMessages" class="col s12">
        <div class = "user-messages">
          {{#if currentUser.username}}
            <h5 class = "profile-header">{{currentUser.username}}'s messages</h5>
          {{else}}
            <h5 class = "profile-header">{{currentUser.profile.name}}'s messages</h5>
          {{/if}}
            <ul class = "collection">
              {{#each userCreated}}
                {{> userMessages}}
              {{/each}}
            </ul>
        </div>
      </div>

      <div id="taggedMessages" class="col s12">
        <div class = "saved-messages">
          {{#if currentUser.username}}
            <h5 class = "profile-header">{{currentUser.username}}'s messages</h5>
          {{else}}
            <h5 class = "profile-header">{{currentUser.profile.name}}'s messages</h5>
          {{/if}}
          <ul class = "collection">
            {{#each taggedMessages}}
              {{> userMessages}}
            {{/each}}
          </ul>
        </div>
      </div>
   </div>
</template>

<template name = "userMessages">
  <li class = "profile-list collection-item">
    <span data-livestamp="{{createdAt}}"></span>
    <p>{{origin}}</p>
      {{#if key}}
          <img src="{{image}}"/>
      {{/if}}
    <p class="text">{{text}}</p>
    <span class="mdi-content-drafts"> {{opens}}</span>
    <span class="mdi-action-thumb-up"> {{likes.length}}</span>
    <span id="delete" class="mdi-action-delete"></span>
  </li>
</template>

<template name = "confirmDelete">
  <div id="confirmation" class="modal c-modal modal-box">
    <a href="#" class="right modal-close">close</a>
    <h4>Your message has been deleted</h4>
  </div>
</template>

<template name = "promptDelete">
  <div id="promptDelete" class="modal c-modal modal-box">
    <div class="modal-content">
      <a href="#" class="right modal-close">close</a>
      <h4>Are you sure you want to delete this message?</h4>
    </div>
    <div class="modal-footer">
      <button id="confirmDeletion" class="btn-flat">Delete</button>
      <button class="modal-close btn-flat">Cancel</button>
    </div>
  </div>
</template>

<template name = "error">
  <div id="error" class="modal c-modal modal-box">
    <a href="#" class="right modal-close">close</a>
    <h4>There was an error with your request. Message was not deleted</h4>
  </div>
</template>
